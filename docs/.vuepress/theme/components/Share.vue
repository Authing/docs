<template>
  <div class="share">
    <v-popover placement="bottom-end">
      <button class="share-btn" @click="refresh" style="margin: 0 20px 0 0">
        <svg
          class="share-icon"
          viewBox="0 0 20 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.8333 11.6667H9.16667C7.79967 11.6661 6.45853 12.0393 5.28823 12.7458C4.11793 13.4522 3.163 14.4651 2.52667 15.675C2.50878 15.4504 2.49989 15.2253 2.5 15C2.5 10.3975 6.23083 6.66667 10.8333 6.66667V2.5L19.1667 9.16667L10.8333 15.8333V11.6667Z"
            fill="#215AE5"
          />
        </svg>

        {{ this.$themeLocaleConfig.share.share }}
      </button>

      <template slot="popover">
        <div class="share-content">
          <button class="share-btn" @click="onCopyLink">
            <svg
              class="share-icon"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8.70684 5.40666L9.65017 6.34999C10.0836 6.78334 10.4273 7.29781 10.6619 7.86403C10.8965 8.43024 11.0172 9.03712 11.0172 9.64999C11.0172 10.2629 10.8965 10.8697 10.6619 11.436C10.4273 12.0022 10.0836 12.5166 9.65017 12.95L9.41417 13.1853C8.53896 14.0605 7.35191 14.5522 6.11417 14.5522C4.87643 14.5522 3.68939 14.0605 2.81417 13.1853C1.93896 12.3101 1.44727 11.1231 1.44727 9.88533C1.44727 8.64759 1.93896 7.46054 2.81417 6.58533L3.7575 7.52866C3.44575 7.83769 3.19811 8.20526 3.02879 8.61026C2.85947 9.01526 2.77182 9.44972 2.77086 9.88868C2.76989 10.3276 2.85565 10.7625 3.02319 11.1682C3.19073 11.574 3.43676 11.9426 3.74716 12.253C4.05756 12.5634 4.42621 12.8094 4.83194 12.977C5.23768 13.1445 5.67251 13.2303 6.11148 13.2293C6.55045 13.2283 6.9849 13.1407 7.3899 12.9714C7.7949 12.8021 8.16247 12.5544 8.4715 12.2427L8.7075 12.0067C9.33241 11.3816 9.68346 10.5339 9.68346 9.64999C9.68346 8.76611 9.33241 7.91842 8.7075 7.29332L7.76417 6.34999L8.7075 5.40733L8.70684 5.40666ZM13.1855 9.41399L12.2428 8.47133C12.5546 8.16229 12.8022 7.79472 12.9716 7.38972C13.1409 6.98472 13.2285 6.55027 13.2295 6.1113C13.2304 5.67233 13.1447 5.2375 12.9772 4.83176C12.8096 4.42603 12.5636 4.05738 12.2532 3.74698C11.9428 3.43658 11.5741 3.19055 11.1684 3.02301C10.7627 2.85547 10.3278 2.76972 9.88886 2.77068C9.44989 2.77164 9.01544 2.85929 8.61044 3.02861C8.20544 3.19793 7.83787 3.44557 7.52884 3.75733L7.29284 3.99333C6.66793 4.61842 6.31688 5.46611 6.31688 6.34999C6.31688 7.23387 6.66793 8.08157 7.29284 8.70666L8.23617 9.64999L7.29284 10.5927L6.35017 9.64999C5.91678 9.21665 5.57299 8.70218 5.33844 8.13596C5.10389 7.56974 4.98317 6.96287 4.98317 6.34999C4.98317 5.73712 5.10389 5.13024 5.33844 4.56403C5.57299 3.99781 5.91678 3.48334 6.35017 3.04999L6.58617 2.81466C7.46138 1.93944 8.64843 1.44775 9.88617 1.44775C11.1239 1.44775 12.311 1.93944 13.1862 2.81466C14.0614 3.68987 14.5531 4.87692 14.5531 6.11466C14.5531 7.3524 14.0614 8.53944 13.1862 9.41466L13.1855 9.41399Z"
                fill="#215AE5"
              />
            </svg>

            {{ this.$themeLocaleConfig.share.copyLink }}
          </button>

          <button class="share-btn" @click="onShareWeibo">
            <svg
              class="share-icon"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11.6832 7.58545C12.5252 7.84679 13.4625 8.47612 13.4625 9.58812C13.4625 11.4301 10.8092 13.7475 6.81984 13.7475C3.7765 13.7475 0.666504 12.2721 0.666504 9.84612C0.666504 8.57812 1.46917 7.11145 2.85117 5.72812C4.69984 3.88145 6.85384 3.03945 7.66384 3.85079C8.02184 4.20879 8.05584 4.82679 7.8265 5.56545C7.70784 5.93679 8.1765 5.73212 8.1765 5.73212C9.66984 5.10679 10.9738 5.06945 11.4492 5.75012C11.7025 6.11212 11.6778 6.62079 11.4438 7.21012C11.3352 7.48145 11.4752 7.52412 11.6832 7.58545ZM6.8285 12.8781C9.25584 12.6368 11.0958 11.1501 10.9398 9.55612C10.7818 7.96212 8.68517 6.86412 6.25784 7.10479C3.83117 7.34479 1.98917 8.83146 2.1465 10.4248C2.3045 12.0208 4.40117 13.1175 6.8285 12.8781ZM4.1065 9.62545C4.60917 8.60745 5.9145 8.03212 7.0705 8.33212C8.26584 8.64079 8.87517 9.76812 8.38784 10.8655C7.89184 11.9868 6.4665 12.5841 5.25784 12.1941C4.08984 11.8168 3.59584 10.6648 4.1065 9.62545ZM5.0705 11.3501C5.44917 11.5215 5.95384 11.3588 6.18784 10.9835C6.4185 10.6048 6.2965 10.1721 5.9165 10.0108C5.54117 9.85279 5.05584 10.0161 4.82317 10.3795C4.58717 10.7441 4.69717 11.1808 5.0705 11.3501ZM6.54117 10.1448C6.68717 10.2061 6.87517 10.1368 6.95984 9.99079C7.04184 9.84412 6.98917 9.68012 6.84117 9.62545C6.69717 9.56945 6.51717 9.63745 6.4325 9.78012C6.3505 9.92279 6.3965 10.0855 6.54117 10.1448ZM13.2485 6.33346C13.2292 6.39437 13.1981 6.45086 13.1569 6.49966C13.1157 6.54846 13.0652 6.58861 13.0083 6.61778C12.9515 6.64695 12.8894 6.66456 12.8258 6.6696C12.7621 6.67463 12.698 6.66699 12.6373 6.64712C12.5766 6.62725 12.5204 6.59554 12.472 6.55383C12.4237 6.51211 12.384 6.46122 12.3554 6.40409C12.3268 6.34696 12.3099 6.28473 12.3055 6.221C12.3011 6.15727 12.3094 6.0933 12.3298 6.03279C12.3805 5.87847 12.3895 5.71347 12.3558 5.55458C12.322 5.39568 12.2469 5.24854 12.1378 5.12812C12.0285 5.00816 11.8897 4.91889 11.7352 4.86918C11.5807 4.81948 11.4159 4.81107 11.2572 4.84479C11.1952 4.85805 11.1312 4.85898 11.0689 4.84751C11.0065 4.83604 10.947 4.81241 10.8938 4.77796C10.7864 4.70838 10.711 4.59897 10.6842 4.47379C10.6574 4.34861 10.6814 4.21791 10.751 4.11045C10.8206 4.00299 10.93 3.92758 11.0552 3.90079C11.3798 3.83142 11.7171 3.84877 12.0329 3.95109C12.3487 4.05342 12.6321 4.2371 12.8544 4.48368C13.0767 4.73026 13.2302 5.03103 13.2994 5.35575C13.3686 5.68046 13.351 6.01767 13.2485 6.33346ZM10.6378 1.95012C11.3046 1.80802 11.9971 1.84379 12.6457 2.05383C13.2943 2.26387 13.8762 2.64079 14.3332 3.14679C14.7904 3.65359 15.1062 4.27175 15.249 4.93922C15.3918 5.60669 15.3564 6.29997 15.1465 6.94945C15.124 7.01965 15.0878 7.0847 15.04 7.14085C14.9922 7.197 14.9338 7.24313 14.8681 7.2766C14.8024 7.31006 14.7308 7.3302 14.6573 7.33584C14.5838 7.34148 14.5099 7.33251 14.4398 7.30945C14.2981 7.26335 14.1805 7.16291 14.1128 7.03018C14.045 6.89744 14.0327 6.74326 14.0785 6.60146C14.2277 6.14023 14.2529 5.64786 14.1516 5.17381C14.0503 4.69977 13.8259 4.26074 13.5012 3.90085C13.1764 3.54095 12.7626 3.27287 12.3015 3.12354C11.8403 2.97421 11.3479 2.94889 10.8738 3.05012C10.7315 3.07273 10.5858 3.03989 10.467 2.95838C10.3481 2.87687 10.2649 2.75287 10.2347 2.61193C10.2045 2.47098 10.2294 2.32381 10.3044 2.2007C10.3794 2.07759 10.4987 1.98791 10.6378 1.95012Z"
                fill="#FB1E1E"
              />
            </svg>

            {{ this.$themeLocaleConfig.share.weibo }}
          </button>

          <button class="share-btn" style="cursor: default">
            <svg
              class="share-icon"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.3825 9.14067C12.5406 9.1386 12.6917 9.07486 12.8035 8.96303C12.9154 8.8512 12.9791 8.70013 12.9812 8.542C12.9812 8.21 12.7152 7.94333 12.3825 7.94333C12.0498 7.94333 11.7838 8.21 11.7838 8.542C11.7838 8.87533 12.0505 9.14067 12.3825 9.14067ZM9.4325 9.14067C9.59064 9.1386 9.74171 9.07486 9.85353 8.96303C9.96536 8.8512 10.0291 8.70013 10.0312 8.542C10.0312 8.21 9.7645 7.94333 9.4325 7.94333C9.09917 7.94333 8.83384 8.21 8.83384 8.542C8.83384 8.87533 9.09984 9.14067 9.4325 9.14067ZM13.8105 12.5007C13.7678 12.5244 13.7337 12.5611 13.7131 12.6054C13.6925 12.6497 13.6864 12.6994 13.6958 12.7473C13.6958 12.7793 13.6958 12.812 13.7125 12.8453C13.7778 13.1233 13.9085 13.566 13.9085 13.5827C13.9085 13.6313 13.9252 13.664 13.9252 13.6973C13.9252 13.7167 13.9214 13.7358 13.9139 13.7536C13.9065 13.7715 13.8957 13.7877 13.882 13.8013C13.8683 13.8149 13.852 13.8257 13.8342 13.833C13.8163 13.8404 13.7972 13.8441 13.7778 13.844C13.7445 13.844 13.7285 13.828 13.6958 13.812L12.7298 13.2547C12.6593 13.2158 12.5809 13.1935 12.5005 13.1893C12.4518 13.1893 12.4025 13.1893 12.3698 13.2053C11.9112 13.3367 11.4365 13.402 10.9292 13.402C8.48917 13.402 6.5245 11.764 6.5245 9.732C6.5245 7.70067 8.48917 6.062 10.9292 6.062C13.3685 6.062 15.3332 7.70067 15.3332 9.732C15.3332 10.83 14.7438 11.8293 13.8105 12.5013V12.5007ZM11.1152 5.39933C11.053 5.39727 10.9907 5.39615 10.9285 5.396C8.14584 5.396 5.85784 7.30267 5.85784 9.73267C5.85784 10.102 5.91117 10.4593 6.00984 10.7993H5.9505C5.36801 10.7935 4.78882 10.711 4.22784 10.554C4.1785 10.5373 4.12917 10.5373 4.07984 10.5373C3.98131 10.5394 3.88513 10.5677 3.80117 10.6193L2.63584 11.2893C2.6025 11.306 2.56984 11.3227 2.53717 11.3227C2.48959 11.3221 2.44411 11.303 2.41047 11.2694C2.37682 11.2357 2.35769 11.1902 2.35717 11.1427C2.35717 11.0933 2.37317 11.0607 2.38984 11.0113C2.40584 10.9953 2.55384 10.4553 2.63584 10.1287C2.63584 10.0953 2.65184 10.0467 2.65184 10.014C2.65166 9.95685 2.63827 9.90052 2.61271 9.8494C2.58715 9.79828 2.55012 9.75377 2.5045 9.71933C1.37184 8.91733 0.666504 7.724 0.666504 6.39867C0.666504 3.96333 3.0465 2 5.9665 2C8.4765 2 10.5865 3.446 11.1152 5.39867V5.39933ZM7.67917 5.678C8.06117 5.678 8.36317 5.36 8.36317 4.994C8.36317 4.612 8.06117 4.31 7.67917 4.31C7.29717 4.31 6.99517 4.612 6.99517 4.994C6.99517 5.376 7.29717 5.678 7.67917 5.678ZM4.1725 5.678C4.5545 5.678 4.85717 5.36 4.85717 4.994C4.85717 4.612 4.5545 4.31 4.1725 4.31C3.79117 4.31 3.4885 4.612 3.4885 4.994C3.4885 5.376 3.79117 5.678 4.1725 5.678Z"
                fill="#20D57D"
              />
            </svg>

            {{ this.$themeLocaleConfig.share.wechat }}
          </button>

          <img :src="qrdata" style="width: 124px; height: 124px" />
        </div>
      </template>
    </v-popover>

    <div
      class="share-content"
      v-if="copied"
      style="position: absolute; width: 144px; padding-bottom: 6px"
    >
      <button class="share-btn" style="margin: 0">
        <svg class="share-icon" viewBox="0 0 24 24">
          <path fill="none" d="M0 0h24v24H0z" />
          <path
            d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.997-6l7.07-7.071-1.414-1.414-5.656 5.657-2.829-2.829-1.414 1.414L11.003 16z"
            fill="rgba(30,183,109,1)"
          />
        </svg>

        {{ this.$themeLocaleConfig.share.copied }}
      </button>
    </div>
  </div>
</template>

<script>
import QRCode from "qrcode";
import IconFont from "@theme/components/IconFont/index.vue";

export default {
  components: {
    IconFont,
  },
  data() {
    return {
      qrdata: "",
      copied: false,
    };
  },
  methods: {
    refresh() {
      QRCode.toDataURL(
        window.location.href,
        { width: 300, errorCorrectionLevel: "M" },
        (err, url) => {
          if (err) {
            this.$message.error("出错了，请刷新重试");
          }
          this.qrdata = url;
        }
      );
    },
    async onCopyLink() {
      await this.$copyText(window.location.href);
      this.copied = true;
      setTimeout(() => {
        this.copied = false;
      }, 1000);
    },
    onShareWeibo() {
      window.open(
        `https://service.weibo.com/share/share.php?title=${encodeURIComponent(
          document.title
        )}&url=${encodeURIComponent(window.location.href)}`
      );
    },
  },
};
</script>

<style lang="stylus" scoped>
.share
  position relative

.share-btn
  border: 0;
  background: none;
  cursor: pointer;
  margin: 8px 0 8px 0
  line-height 20px
  font-size 14px

.share-icon
  width 20px
  height 20px
  display: inline-block;
  vertical-align: bottom;

.share-content
  box-sizing border-box
  color: #1D2129;
  width 155px
  padding: 8px 10px 0px 16px
  border-radius 4px
  border: 1px solid #E5E6EB;
  background: #fff
  word-break: break-word
  wrap: break-word
</style>
